''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''' "check_sharedfolder.wsf"' Original from' fabio.frioni@gmail.com'' 21.02.2011 ver 1.0_b1'' Updated: 28.12.2011 ver 1.3_b1' added /file option to check the existance of specified file (in the specified share or locally)' --------------------------------------------------------------------------' This plugin returns if a shared folder is published in a windows system'<job><runtime><description>This plugin cheks when a shared folder is published in a windows system</description><namedname="h"helpstring="Help"type="simple"required="false" /><namedname="name"helpstring="The name of shared folder to check (use :b: to emule spaces)."type="string"required="false" /><namedname="file"helpstring="The file name into the folder to check (use :b: to emule spaces). If no name argument is specified, the file will be found locally: you can specify a complete full path name."type="string"required="false" /><example>check_sharedfolder.wsf /name:My_Shared_Name /file:file_name.ext</example></runtime>    <script language="VBScript">Function streamEcho(str)    WScript.Stdout.Write str    streamEcho = 0End FunctionFunction unxEcho(str)    WScript.Stdout.Write str & vblf    unxEcho = 0End FunctionFunction dosEcho(str)    WScript.Stdout.Write str & vbcrlf    dosEcho = 0End Function    'Cons for return val's    Const intOK = 0    Const intWarning = 1    Const intCritical = 2    Const intUnknown = 3    ' Dim local variables    Dim ReturnCode,OutString,StrALERT(4)    dim filesys, filetxt, getname, path, shareName, fileName    shareName = ""    fileName = ""    StrALERT(0) = "OK"    StrALERT(1) = "WARNING"    StrALERT(2) = "CRITICAL"    StrALERT(3) = "UNKNOWN"    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''    ' Help    ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''    If (Not Wscript.Arguments.Named.Exists("name") AND Not Wscript.Arguments.Named.Exists("file")) Or Wscript.Arguments.Named.Exists("h") Then        dosEcho("check_sharedfolder (nrpe_nt-plugin) 21.02.2011 ver 1.0_b1")        dosEcho("The nagios plugins come with ABSOLUTELY NO WARRANTY. You may redistribute")        dosEcho("copies of the plugins under the terms of the GNU General Public License.")        dosEcho("For more information about these matters, see the file named COPYING.")        dosEcho("")        dosEcho("Author: Fabio Frioni - Intesi Group SPA (ffrioni@intesigroup.com) (fabio.frioni@gmail.com)")        dosEcho("")        dosEcho("Plugin help screen:")        Wscript.Arguments.ShowUsage()        Wscript.Quit(intUnknown)    End If    If Wscript.Arguments.Named.Exists("name") Then        shareName = Wscript.Arguments.Named("name")        shareName = Replace(shareName,":b:"," ")    End If    If Wscript.Arguments.Named.Exists("file") Then        fileName = Wscript.Arguments.Named("file")        fileName = Replace(fileName,":b:"," ")    End If    ReturnCode = intUnknown    If shareName <> "" Then        ReturnCode = intCritical        strComputer = "."        Set objWMIService = GetObject("winmgmts:" _                            & "{impersonationLevel=impersonate}!\\" & strComputer & "\root\cimv2")        Set colShares = objWMIService.ExecQuery("Select * from Win32_Share")        OutString = "CRITICAL: The (" & shareName & ") shared folder name not defined!"        For each objShare in colShares            if UCase(objShare.Name) = UCase(shareName) Then                OutString = "OK: The (" & shareName & "," & objShare.Caption & ") shared folder name defined."                ReturnCode = intOK                If fileName <> "" Then                    Set filesys = CreateObject("Scripting.FileSystemObject")                    If filesys.FileExists(objShare.Path & "\" & fileName) Then                        OutString = OutString & " OK: The file (" & fileName & ") exist!"                        ReturnCode = intOk                    Else                        OutString = OutString & " CRITICAL: The file (" & fileName & ") not exist!"                        ReturnCode = intCritical                    End If                    Set filesys = nothing                End If                Exit For            End If        REM Wscript.Echo "AllowMaximum: " & vbTab &  objShare.AllowMaximum           REM Wscript.Echo "Caption: " & vbTab &  objShare.Caption           REM Wscript.Echo "MaximumAllowed: " & vbTab &  objShare.MaximumAllowed        REM Wscript.Echo "Name: " & vbTab &  objShare.Name           REM Wscript.Echo "Path: " & vbTab &  objShare.Path           REM Wscript.Echo "Type: " & vbTab &  objShare.Type           Next    Else        ReturnCode = intCritical        Set filesys = CreateObject("Scripting.FileSystemObject")        If filesys.FileExists(fileName) Then            OutString = "OK: The file (" & fileName & ") exist!"            ReturnCode = intOk        Else            OutString = "CRITICAL: The file (" & fileName & ") not exist!"            ReturnCode = intCritical        End If        Set filesys = nothing    End If    streamEcho OutString    Wscript.Quit(ReturnCode)    ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''    </script></job>